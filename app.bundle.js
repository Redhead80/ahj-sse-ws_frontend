!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);new class{constructor(e){this.url=e,this.container=document.querySelector("body"),this.usersOnline=[],this.currentUser=null,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log("connected")},this.ws.onmessage=e=>{const t=JSON.parse(e.data);"error"===t.type?alert("Такой никнейм занят, необходимо выбрать другой"):"users"===t.type?(this.usersOnline=t.data,this.deleteForm(),this.showChat()):"addMes"===t.type&&this.showNewMess(t.data.data)},this.ws.onclose=e=>{console.log("connection closed",e.code)},this.ws.onerror=()=>{console.log("error")},window.addEventListener("beforeunload",()=>{this.ws.send(JSON.stringify({type:"deleteUser",user:this.currentUser}))})}createForm(){const e=document.createElement("form");e.classList.add("widget"),e.innerHTML=' <h2>Выберите псевдоним</h2>\n        <input class="input widget-input" type="text" name="nick" required>\n        <button type="submit" class="btn">Продолжить</button>',this.container.insertAdjacentElement("afterbegin",e),e.addEventListener("submit",t=>{t.preventDefault();const s=e.nick.value,n={type:"addUser",user:s};this.currentUser=s,this.ws.send(JSON.stringify(n))})}deleteForm(){this.container.removeChild(this.container.firstChild)}showChat(){if(!document.querySelector(".container")){const e=document.createElement("div");e.classList.add("container"),e.innerHTML='<section class="chat-users"></section>\n            <section class="chat">\n             <div class="chat-content"></div>\n                       <form class="chat-form">\n                    <input class="input chat-form-input" type="text" aria-label="Ваше сообщение" name="message" placeholder="Напишите сообщение" required>\n                </form>\n            </section>',this.container.appendChild(e);const t=e.querySelector(".chat-form");t.addEventListener("submit",e=>{e.preventDefault();const s=t.message.value,n=`${(new Date).toLocaleDateString()} ${(new Date).toLocaleTimeString().slice(0,-3)}`;this.ws.send(JSON.stringify({type:"addMes",data:{name:this.currentUser,message:s,time:n}})),t.message.value=""})}this.showUsers()}showUsers(){const e=document.querySelector(".chat-users");e.innerHTML="",this.usersOnline.forEach(t=>{const s=document.createElement("div");s.classList.add("user"),s.innerHTML="";const n=document.createElement("div");n.classList.add("user-name"),n.textContent=t.name,t.name===this.currentUser&&(n.textContent="You"),s.appendChild(n),e.appendChild(s)})}createMessage(e){const t=document.createElement("div");t.classList.add("chat-message"),t.innerHTML=` <div class="mes-top"><span class="chat-message-name"></span>\n            <span class="chat-message-time">${e.time}</span></div>\n            <div class="chat-mes-content">${e.message}</div>`;const s=t.querySelector(".chat-message-name");return e.name===this.currentUser?(s.textContent="You",t.classList.add("you-mes")):(t.classList.remove("you-mes"),s.textContent=e.name),t}showNewMess(e){const t=this.createMessage(e);this.container.querySelector(".chat-content").appendChild(t)}}("wss://ahj-sse-ws-chat.herokuapp.com/ws").createForm()}]);